@page "/page/{PageId:guid}"
@using CoreBuilder.Models
@using CoreBuilder.Data
@inject AppDbContext Context
@inject NavigationManager Navigation

<div class="container-fluid">
    @if (page == null)
    {
        <h3 class="fw-bold text-dark">Sayfa Yükleniyor...</h3>
    }
    else
    {
        <h3 class="fw-bold text-dark">Sayfa Düzenleme: @page.Title</h3>
        <p class="text-muted small">Değişikliklerinizi kaydederek sitenizin içeriğini güncelleyin.</p>

        <div class="row">
            <div class="col-md-8">
                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-body">

                        <div class="mb-3">
                            <label class="form-label fw-bold">Sayfa Başlığı</label>
                            <input class="form-control" @bind="page.Title" />
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">URL Slug</label>
                            <input class="form-control" @bind="page.Slug" />
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label fw-bold">İçerik (HTML)</label>
                            <textarea class="form-control" @bind="page.Content" rows="15" style="font-family: monospace;"></textarea>
                            <small class="form-text text-muted">Buraya HTML kodu girebilirsiniz.</small>
                        </div>
                        
                        <button class="btn btn-primary" @onclick="SavePage">
                            <span class="oi oi-check me-2"></span> Değişiklikleri Kaydet
                        </button>
                        
                        <button class="btn btn-outline-secondary ms-2" @onclick="GoBack">
                            <span class="oi oi-action-undo me-2"></span> Geri Dön
                        </button>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card shadow-sm border-0">
                    <div class="card-header bg-white fw-bold">Yayınlama Ayarları</div>
                    <div class="card-body">
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" role="switch" id="isPublishedSwitch" @bind="page.IsPublished">
                            <label class="form-check-label" for="isPublishedSwitch">Sayfa Yayınlansın</label>
                        </div>
                        <p class="text-muted small">Sayfayı yayından kaldırmak için işareti kaldırın.</p>
                    </div>
                </div>
            </div>
        </div>
    }
</div>

@code {
    [Parameter]
    public Guid PageId { get; set; }

    private Page? page;

    protected override void OnParametersSet()
    {
        page = Context.Pages.Find(PageId);
    }

    private void SavePage()
    {
        if (page != null)
        {
            if (string.IsNullOrWhiteSpace(page.Title) || string.IsNullOrWhiteSpace(page.Content))
            {
                return;
            }

            Context.Pages.Update(page);
            Context.SaveChanges();
            
            Navigation.NavigateTo("/pages");
        }
    }

    private void GoBack()
    {
        Navigation.NavigateTo("/pages");
    }
}